# Maintainer: Timo Ter√§s <timo.teras@iki.fi>
pkgname=lua-cqueues-pushy
pkgver=0.20151118
_commitid=8e6681f43ccf2345f39831d9b6b1d5e22fac5f52
pkgrel=0
pkgdesc="Framework for logic control (based on cqueues)"
url="https://github.com/fabled/lua-cqueues-pushy"
arch="all"
license="GPLv2"
depends="lua5.3 lua5.3-cqueues>=20150616 lua5.3-struct lua5.3-posix lua5.3-ldbus"
makedepends="lua5.3-dev"
install=""
subpackages=""
source="$pkgname-$pkgver.tar.gz::https://github.com/fabled/$pkgname/archive/$_commitid.tar.gz
	cqpushy.initd
	"

_srcdir="$srcdir"/$pkgname-$_commitid

prepare() {
	local i
	cd "$_srcdir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$_srcdir"
	make LUA_VERSION=5.3
}

package() {
	cd "$_srcdir"
	make LUA_VERSION=5.3 install DESTDIR="$pkgdir" || return 1
	install -m755 -D "$srcdir"/cqpushy.initd \
		"$pkgdir"/etc/init.d/cqpushy || return 1
}

md5sums="69f75abba3d19aa570ca7b4c46662459  lua-cqueues-pushy-0.20151118.tar.gz
f585d5983128ccb9b9d33a6019107158  cqpushy.initd"
sha256sums="514bb96e4fbf271641ca80c5f1142aa58009d3cba5ff2f769b2c9f2d0ec74cf3  lua-cqueues-pushy-0.20151118.tar.gz
4ebdbd3299c4b18b7224edc202bd9a4d5a97f325a474ec222901dbedf7f3bc58  cqpushy.initd"
sha512sums="20cc2382d56c9e56e2ada0b28a4ec901a0bf27096a56a01e2283eb9ba93dc8d37f58e775020120938a20872c3f3f90439416534a79d68d8df041ee2483e62585  lua-cqueues-pushy-0.20151118.tar.gz
9599db364c3a2e77a7fee61304182961cb6132ce9cb58e9b6837312f52a582e838fdb54eb932c3204b558e3db7228a0412870d0a02125d1017f3402155647bd0  cqpushy.initd"
